<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ìœ ì¶• íƒ€ì´ë¨¸</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F2A58E">
<link rel="apple-touch-icon" href="edit_icon_pump_timer.png">

<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FFF8F2;
    --warm-rose: #F2A58E;
    --soft-coral: #E8896E;
    --blush: #F7D5C8;
    --deep-rose: #C4614A;
    --warm-brown: #8B5E52;
    --muted-gold: #D4A96A;
    --text-dark: #3D2B24;
    --text-mid: #7A5049;
    --text-light: #B8897D;
    --white: #FFFFFF;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Gowun Dodum', sans-serif;
    background: var(--cream);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
  }

  .phone-wrap {
    width: 100%;
    max-width: 390px;
    min-height: 100vh;
    background: var(--cream);
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* ìš°ìƒë‹¨ ë²„ì „ í…ìŠ¤íŠ¸ */
  .version-tag {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 11px;
    color: var(--text-light);
    z-index: 10;
    font-weight: 300;
  }

  .blob {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }
  .blob-1 {
    width: 280px; height: 280px;
    background: radial-gradient(circle, #FBDDD0 0%, transparent 70%);
    top: -80px; right: -60px;
  }
  .blob-2 {
    width: 200px; height: 200px;
    background: radial-gradient(circle, #F7E8D8 0%, transparent 70%);
    bottom: 100px; left: -60px;
  }

  /* ===== PAGE SYSTEM ===== */
  .page {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 28px;
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: opacity 0.45s ease, transform 0.45s ease;
    z-index: 1;
  }
  .page.active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: all;
  }

  /* ===== START PAGE ===== */
  .logo-area {
    text-align: center;
    margin-bottom: 48px;
  }
  .logo-icon {
    font-size: 44px;
    margin-bottom: 10px;
    display: block;
    animation: float 3s ease-in-out infinite;
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  .logo-title {
    font-family: 'Noto Serif KR', serif;
    font-size: 22px;
    color: var(--text-dark);
    letter-spacing: 2px;
    font-weight: 600;
  }
  .logo-sub {
    font-size: 13px;
    color: var(--text-light);
    margin-top: 6px;
    letter-spacing: 1px;
  }

  .section-label {
    font-family: 'Noto Serif KR', serif;
    font-size: 17px;
    color: var(--text-dark);
    text-align: center;
    margin-bottom: 32px;
    font-weight: 400;
    line-height: 1.6;
  }

  .dir-btns {
    display: flex;
    gap: 32px;
    margin-bottom: 44px;
  }

  .dir-btn {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    font-family: 'Noto Serif KR', serif;
    font-size: 18px;
    font-weight: 600;
    letter-spacing: 1px;
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
    outline: none;
  }
  .dir-btn-left {
    background: linear-gradient(135deg, #F2A58E, #E8796A);
    color: white;
    box-shadow: 0 8px 28px rgba(232, 121, 106, 0.35);
  }
  .dir-btn-right {
    background: linear-gradient(135deg, #D4A96A, #C49050);
    color: white;
    box-shadow: 0 8px 28px rgba(196, 144, 80, 0.35);
  }
  .dir-btn:active {
    transform: scale(0.93);
  }
  .dir-btn-label {
    font-size: 12px;
    font-weight: 300;
    display: block;
    margin-top: 3px;
    opacity: 0.85;
    letter-spacing: 0;
    font-family: 'Gowun Dodum', sans-serif;
  }

  .time-input-area {
    display: flex;
    align-items: center;
    gap: 10px;
    background: white;
    border-radius: 20px;
    padding: 16px 24px;
    box-shadow: 0 4px 20px rgba(196, 97, 74, 0.1);
  }
  .time-label {
    font-size: 15px;
    color: var(--text-mid);
  }
  .time-input {
    width: 56px;
    border: none;
    border-bottom: 2px solid var(--warm-rose);
    background: transparent;
    font-family: 'Noto Serif KR', serif;
    font-size: 22px;
    color: var(--deep-rose);
    text-align: center;
    outline: none;
    font-weight: 600;
  }

  .footer-notice {
    margin-top: auto;
    padding-bottom: 20px;
    text-align: center;
    font-size: 11px;
    color: var(--text-light);
    line-height: 1.8;
  }

  /* ===== TIMER PAGE ===== */
  #page-timer { 
    padding-bottom: 160px; /* í•˜ë‹¨ ë²„íŠ¼ì— ê°€ë ¤ì§€ì§€ ì•Šë„ë¡ ì—¬ë°± ì¶”ê°€ */
  }
  .timer-header { text-align: center; margin-bottom: 36px; }
  .timer-direction { font-size: 13px; color: var(--text-light); letter-spacing: 2px; margin-bottom: 6px; }
  .timer-side { font-family: 'Noto Serif KR', serif; font-size: 26px; color: var(--text-dark); font-weight: 600; }

  .circle-wrap { position: relative; width: 240px; height: 240px; margin-bottom: 48px; }
  .circle-bg { position: absolute; inset: 0; border-radius: 50%; background: white; box-shadow: 0 12px 40px rgba(196, 97, 74, 0.15), inset 0 0 0 2px #F5E0D8; }
  .circle-svg { position: absolute; inset: 0; transform: rotate(-90deg); }
  .circle-track { fill: none; stroke: #F5E0D8; stroke-width: 8; }
  .circle-progress { fill: none; stroke: var(--warm-rose); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 691; stroke-dashoffset: 0; transition: stroke-dashoffset 1s linear; }
  .circle-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .time-display { font-family: 'Noto Serif KR', serif; font-size: 52px; font-weight: 300; color: var(--text-dark); letter-spacing: 2px; }
  .time-unit { font-size: 13px; color: var(--text-light); margin-top: 6px; }

  /* ìƒíƒœ ë¬¸êµ¬ ìœ„ì¹˜ ë° ì—¬ë°± ìˆ˜ì • */
  .session-stats {
    font-size: 13px;
    color: var(--text-mid);
    text-align: center;
    line-height: 1.8;
    margin-top: 20px;
    padding: 10px;
    /*background: rgba(255, 255, 255, 0.5); /* ê°€ë…ì„±ì„ ìœ„í•´ ì˜…ì€ ë°°ê²½ ì¶”ê°€ */
    border-radius: 12px;
    width: 100%;
    max-width: 320px;
  }

  .bottom-actions {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 390px;
    padding: 20px 28px 36px;
    background: linear-gradient(to top, var(--cream) 75%, transparent);
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 10;
  }

  .btn-primary {
    width: 100%; padding: 17px; border: none; border-radius: 18px;
    background: linear-gradient(135deg, #F2A58E, #E8796A);
    color: white; font-family: 'Noto Serif KR', serif; font-size: 17px; font-weight: 600; cursor: pointer;
    box-shadow: 0 6px 24px rgba(232, 121, 106, 0.35); transition: transform 0.18s;
  }
  .btn-secondary {
    width: 100%; padding: 14px; border: 2px solid var(--blush); border-radius: 18px;
    background: transparent; color: var(--text-mid); font-family: 'Gowun Dodum', sans-serif;
    font-size: 15px; cursor: pointer;
  }
  .btn-primary:active, .btn-secondary:active { transform: scale(0.97); }

  .stats-inline { text-align: center; font-size: 12px; color: var(--text-light); padding-top: 4px; }
  .hidden { display: none !important; }

  /* ë²„íŠ¼ ê°€ë¡œ ë°°ì¹˜ë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ ë° ì—¬ë°± ì¡°ì • */
  .btn-row {
    display: flex;
    gap: 12px;
    width: 100%;
    margin-bottom: 10px;
  }
  .btn-row button {
    flex: 1;
  }
  
  /* ===== DONE PAGE ===== */
  .done-card { background: white; border-radius: 32px; padding: 40px 32px; box-shadow: 0 16px 50px rgba(196, 97, 74, 0.12); text-align: center; width: 100%; }
  .done-icon { font-size: 52px; margin-bottom: 20px; display: block; animation: float 3s ease-in-out infinite; }
  .done-title { font-family: 'Noto Serif KR', serif; font-size: 22px; color: var(--text-dark); font-weight: 600; margin-bottom: 28px; }
  .done-stats { background: var(--cream); border-radius: 20px; padding: 22px 24px; margin-bottom: 24px; }
  .done-stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--blush); }
  .done-stat-row:last-child { border-bottom: none; }
  .done-stat-label { font-size: 15px; color: var(--text-mid); }
  .done-stat-value { font-family: 'Noto Serif KR', serif; font-size: 17px; color: var(--deep-rose); font-weight: 600; }
  .done-total-row { display: flex; justify-content: space-between; margin-top: 16px; padding-top: 12px; border-top: 2px solid var(--blush); }
  .done-total-label { font-size: 14px; color: var(--text-light); }
  .done-total-value { font-family: 'Noto Serif KR', serif; font-size: 20px; color: var(--warm-brown); font-weight: 600; }
  .done-love { font-size: 15px; color: var(--warm-rose); margin-top: 6px; animation: pulse 2s ease-in-out infinite; }

  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
  .ping-ring { position: absolute; inset: -12px; border-radius: 50%; border: 3px solid var(--warm-rose); animation: ping 1.2s ease-out infinite; display: none; }
  .ping-ring.show { display: block; }
  @keyframes ping { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }
</style>
</head>
<body>
<div class="phone-wrap">
  <div class="version-tag">v.1.0</div>
  
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <div class="page active" id="page-start">
    <div class="logo-area">
      <span class="logo-icon">ğŸ¤±</span>
      <div class="logo-title">ìœ ì¶• íƒ€ì´ë¨¸</div>
      <div class="logo-sub">ì†Œì¤‘í•œ ì‹œê°„ì„ í•¨ê»˜í•´ìš”</div>
    </div>

    <div class="section-label">ìœ ì¶• ì‹œì‘ ë°©í–¥ì„<br>ì„ íƒí•´ ì£¼ì„¸ìš”</div>

    <div class="dir-btns">
      <button class="dir-btn dir-btn-left" onclick="handleBtnClick(() => startTimer('left'))">
        ì™¼ìª½
        <span class="dir-btn-label">â—€ LEFT</span>
      </button>
      <button class="dir-btn dir-btn-right" onclick="handleBtnClick(() => startTimer('right'))">
        ì˜¤ë¥¸ìª½
        <span class="dir-btn-label">RIGHT â–¶</span>
      </button>
    </div>

    <div class="time-input-area">
      <span class="time-label">1íšŒ ìœ ì¶• ì‹œê°„</span>
      <input type="number" class="time-input" id="duration-input" value="5" min="1" max="60">
      <span class="time-label">ë¶„</span>
    </div>

    <div class="footer-notice"><br>
      â€» ë¸Œë¼ìš°ì €ë¥¼ ì¼  ìƒíƒœë¡œ ìœ ì§€í•´ì£¼ì„¸ìš”.<br>
      â€» ìŠ¤ë§ˆíŠ¸í° ë¬´ìŒ ëª¨ë“œë¥¼ í•´ì œí•´ì£¼ì„¸ìš”.<br>
      â€» ìŠ¤ë§ˆíŠ¸í° ë³¼ë¥¨ì„ ì‚´ì§ ì˜¬ë ¤ì£¼ì„¸ìš”.
    </div>
  </div>

  <div class="page" id="page-timer">
    <div class="timer-header">
      <div class="timer-direction">í˜„ì¬ ìœ ì¶• ì¤‘</div>
      <div class="timer-side" id="timer-side-label">ì™¼ìª½ ê°€ìŠ´</div>
    </div>

    <div class="circle-wrap">
      <div class="circle-bg"></div>
      <div class="ping-ring" id="ping-ring"></div>
      <svg class="circle-svg" viewBox="0 0 240 240">
        <circle class="circle-track" cx="120" cy="120" r="110"/>
        <circle class="circle-progress" id="circle-prog" cx="120" cy="120" r="110"/>
      </svg>
      <div class="circle-center">
        <div class="time-display" id="time-display">05:00</div>
        <div class="time-unit">ë‚¨ì€ ì‹œê°„</div>
      </div>
    </div>

    <div class="session-stats" id="session-stats"></div>

    <div class="bottom-actions" id="timer-actions-container">
      <div id="running-actions">
        <div class="btn-row">
          <button class="btn-secondary" id="btn-pause" onclick="handleBtnClick(togglePause)">ì¼ì‹œì •ì§€</button>
          <button class="btn-primary" onclick="handleBtnClick(startOpposite)">ë°˜ëŒ€ìª½ ì‹œì‘</button>
        </div>
        <button class="btn-secondary" onclick="handleBtnClick(endSession)">ì¢…ë£Œí•˜ê¸°</button>
      </div>
      
      <div id="end-actions" class="hidden">
        <button class="btn-primary" onclick="handleBtnClick(startOpposite)">ë°˜ëŒ€ìª½ ì‹œì‘</button>
        <button class="btn-secondary" style="margin-top:10px;" onclick="handleBtnClick(endSession)">ì „ì²´ ì¢…ë£Œ</button>
        <div class="stats-inline" id="stats-inline-text"></div>
      </div>
    </div>
  </div> 

  <div class="page" id="page-done">
    <div class="done-card">
      <span class="done-icon">ğŸ’•</span>
      <div class="done-title">ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”</div>
      <div class="done-stats" id="done-stats-area"></div>
      <div class="done-love">ì—„ë§ˆ ê³ ë§ˆì›Œìš” â™¥</div>
      <div style="margin-top: 32px; width: 100%;">
        <button class="btn-primary" onclick="handleBtnClick(resetApp)">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>
</div>

<script>
  let state = {
    currentSide: '',
    durationMin: 5,
    timerInterval: null,
    secondsLeft: 0,
    totalSeconds: 0,
    isPaused: false, // ì¼ì‹œì •ì§€ ìƒíƒœ ì¶”ì 
    sessions: { left: { count: 0, seconds: 0 }, right: { count: 0, seconds: 0 } }
  };

  // 2. ì¼ì‹œì •ì§€ í† ê¸€ í•¨ìˆ˜ ì¶”ê°€
  function togglePause() {
    const pauseBtn = document.getElementById('btn-pause');
    if (!state.isPaused) {
      state.isPaused = true;
      clearInterval(state.timerInterval);
      state.timerInterval = null;
      pauseBtn.textContent = 'ë‹¤ì‹œ ì‹œì‘';
      releaseWakeLock();
    } else {
      state.isPaused = false;
      pauseBtn.textContent = 'ì¼ì‹œì •ì§€';
      requestWakeLock();
      startInterval();
    }
  }

  

  const CIRCUMFERENCE = 2 * Math.PI * 110;
  let wakeLock = null;
  let audioCtx = null;

  // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ë° ì „ì†¡ ë¡œì§
  function requestNotificationPermission() {
    if ("Notification" in window) {
      Notification.requestPermission();
    }
  }
  
  function sendNotification() {
    if ("Notification" in window && Notification.permission === "granted") {
      navigator.serviceWorker.ready.then((registration) => {
        registration.showNotification("íƒ€ì´ë¨¸ ì™„ë£Œ!", {
          body: `${state.currentSide === 'left' ? 'ì™¼ìª½' : 'ì˜¤ë¥¸ìª½'} ìœ ì¶•ì´ ëë‚¬ìŠµë‹ˆë‹¤.`,
          icon: "https://cdn-icons-png.flaticon.com/512/1791/1791171.png", // ì•± ì•„ì´ì½˜
          vibrate: [200, 100, 200],
          tag: "timer-done"
        });
      });
    }
  }
  
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ë˜ëŠ” ì²« ë²„íŠ¼ í´ë¦­ ì‹œ ê¶Œí•œ ìš”ì²­
  window.addEventListener('load', requestNotificationPermission);


  // ê³µí†µ ë²„íŠ¼ í•¸ë“¤ëŸ¬: ì†Œë¦¬ ì¬ìƒ + ì•¡ì…˜ ì‹¤í–‰
  function handleBtnClick(actionFunc) {
    warmAudio();      // ì˜¤ë””ì˜¤ í™œì„±í™”
    playClickBeep();  // í´ë¦­ ë¹„í”„ìŒ
    if (actionFunc) actionFunc();
  }

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  async function requestWakeLock() {
    try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); }
    catch (err) { console.warn('WakeLock error:', err); }
  }

  function releaseWakeLock() {
    if (wakeLock !== null) { wakeLock.release(); wakeLock = null; }
  }

  function warmAudio() {
    try {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') audioCtx.resume();
    } catch(e) {}
  }

  // ë²„íŠ¼ í´ë¦­ ë¹„í”„ìŒ (ì§§ê³  ëª…í™•í•œ ì†Œë¦¬)
  function playClickBeep() {
    try {
      const ctx = audioCtx;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain); gain.connect(ctx.destination);
      osc.frequency.value = 660; // ì•½ê°„ ë‚®ì€ ë„#
      osc.type = 'sine';
      gain.gain.setValueAtTime(0, ctx.currentTime);
      gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.02);
      gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 0.1);
      osc.start(); osc.stop(ctx.currentTime + 0.12);
    } catch(e) {}
  }

  // íƒ€ì´ë¨¸ ì¢…ë£Œ ì•ŒëŒ (2íšŒ ë°˜ë³µ)
  async function playAlarm() {
    try {
      if (audioCtx.state === 'suspended') await audioCtx.resume();
      const ctx = audioCtx;
      function beep(startTime) {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain); gain.connect(ctx.destination);
        osc.frequency.value = 880; osc.type = 'sine';
        gain.gain.setValueAtTime(0, startTime);
        gain.gain.linearRampToValueAtTime(0.8, startTime + 0.05);
        gain.gain.setValueAtTime(0.8, startTime + 0.35);
        gain.gain.linearRampToValueAtTime(0, startTime + 0.55);
        osc.start(startTime); osc.stop(startTime + 0.6);
      }
      beep(ctx.currentTime); beep(ctx.currentTime + 0.75);
    } catch(e) {}
  }

  function startTimer(side) {
    state.durationMin = parseInt(document.getElementById('duration-input').value) || 5;
    state.currentSide = side;
    document.getElementById('running-actions').classList.remove('hidden');
    document.getElementById('end-actions').classList.add('hidden');
    document.getElementById('ping-ring').classList.remove('show');
    runTimer();
  }
// 4. ë°˜ëŒ€ìª½ ì‹œì‘ í•¨ìˆ˜ ìˆ˜ì • (ê¸°ì¡´ runTimerë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ ì´ˆê¸°í™” í¬í•¨ë¨)
  function startOpposite() {
    state.currentSide = state.currentSide === 'left' ? 'right' : 'left';
    document.getElementById('running-actions').classList.remove('hidden');
    document.getElementById('end-actions').classList.add('hidden');
    document.getElementById('ping-ring').classList.remove('show');
    runTimer();
  }

  function runTimer() {
    document.getElementById('timer-side-label').textContent = state.currentSide === 'left' ? 'ì™¼ìª½ ê°€ìŠ´' : 'ì˜¤ë¥¸ìª½ ê°€ìŠ´';
    showPage('page-timer');
    requestWakeLock();

    // ì¼ì‹œì •ì§€ ìƒíƒœ ì´ˆê¸°í™”
    state.isPaused = false;
    document.getElementById('btn-pause').textContent = 'ì¼ì‹œì •ì§€';

    state.secondsLeft = state.durationMin * 60;
    state.totalSeconds = state.durationMin * 60;
    updateDisplay();
    updateCircle(1);
    
    startInterval();
  }

  // ì¸í„°ë²Œ ì‹¤í–‰ ë¡œì§
  function startInterval() {
    if (state.timerInterval) clearInterval(state.timerInterval);
    state.timerInterval = setInterval(() => {
      state.secondsLeft--;
      state.sessions[state.currentSide].seconds++;
      updateDisplay();
      updateCircle(state.secondsLeft / state.totalSeconds);
      if (state.secondsLeft <= 0) {
        clearInterval(state.timerInterval);
        state.timerInterval = null;
        state.sessions[state.currentSide].count++; // íšŒìˆ˜ ì¦ê°€
        onTimerEnd();
      }
    }, 1000);
  }

  function updateDisplay() {
    const m = Math.floor(state.secondsLeft / 60).toString().padStart(2, '0');
    const s = (state.secondsLeft % 60).toString().padStart(2, '0');
    document.getElementById('time-display').textContent = `${m}:${s}`;
    
    // ì´ ë¶€ë¶„ì´ í˜¸ì¶œë  ë•Œ íšŸìˆ˜ê°€ í¬í•¨ëœ í…ìŠ¤íŠ¸ê°€ ê°±ì‹ ë©ë‹ˆë‹¤.
    document.getElementById('session-stats').textContent = getStatsText();
  }

  function updateCircle(ratio) {
    const offset = CIRCUMFERENCE * (1 - ratio);
    document.getElementById('circle-prog').style.strokeDashoffset = offset;
    document.getElementById('circle-prog').style.strokeDasharray = CIRCUMFERENCE;
  }

  function onTimerEnd() {
    playAlarm(); // ê¸°ì¡´ ì‚¬ìš´ë“œ ìœ ì§€
    sendNotification(); // [ì¶”ê°€] ì‹œìŠ¤í…œ ì•Œë¦¼ ë°œì†¡
    
    document.getElementById('ping-ring').classList.add('show');
    document.getElementById('running-actions').classList.add('hidden');
    document.getElementById('end-actions').classList.remove('hidden');
    document.getElementById('stats-inline-text').textContent = getStatsText();
  }

  function getStatsText() {
    const L = state.sessions.left;
    const R = state.sessions.right;
    return `ì™¼ìª½ ${Math.floor(L.seconds/60)}ë¶„(${L.count}íšŒ)  Â·  ì˜¤ë¥¸ìª½ ${Math.floor(R.seconds/60)}ë¶„(${R.count}íšŒ)`;
  }

  function endSession() {
    if (state.timerInterval) { clearInterval(state.timerInterval); state.timerInterval = null; }
    releaseWakeLock();
    buildDoneStats();
    showPage('page-done');
  }

  function resetApp() {
    state.sessions.left = { count: 0, seconds: 0 };
    state.sessions.right = { count: 0, seconds: 0 };
    state.currentSide = '';
    if (state.timerInterval) clearInterval(state.timerInterval);
    document.getElementById('ping-ring').classList.remove('show');
    updateCircle(1);
    showPage('page-start');
  }

  function buildDoneStats() {
    const L = state.sessions.left; const R = state.sessions.right;
    const totalS = L.seconds + R.seconds;
    document.getElementById('done-stats-area').innerHTML = `
      <div class="done-stat-row"><span class="done-stat-label">â—€ ì™¼ìª½</span><span class="done-stat-value">${Math.floor(L.seconds/60)}ë¶„ ${L.seconds%60}ì´ˆ</span></div>
      <div class="done-stat-row"><span class="done-stat-label">ì˜¤ë¥¸ìª½ â–¶</span><span class="done-stat-value">${Math.floor(R.seconds/60)}ë¶„ ${R.seconds%60}ì´ˆ</span></div>
      <div class="done-total-row"><span class="done-total-label">ì´ ìœ ì¶• ì‹œê°„</span><span class="done-total-value">${Math.floor(totalS/60)}ë¶„ ${totalS%60}ì´ˆ</span></div>
    `;
  }

  // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (PWA í•µì‹¬)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
    });
  }

  document.addEventListener('visibilitychange', async () => {
    if (wakeLock !== null && document.visibilityState === 'visible') await requestWakeLock();
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  });
</script>
</body>
</html>
