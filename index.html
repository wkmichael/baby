<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ìœ ì¶• íƒ€ì´ë¨¸</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F2A58E">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1791/1791171.png">

<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FFF8F2; --warm-rose: #F2A58E; --soft-coral: #E8896E; --blush: #F7D5C8;
    --deep-rose: #C4614A; --warm-brown: #8B5E52; --muted-gold: #D4A96A; --text-dark: #3D2B24;
    --text-mid: #7A5049; --text-light: #B8897D; --white: #FFFFFF;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Gowun Dodum', sans-serif; background: var(--cream); display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden; }
  .phone-wrap { width: 100%; max-width: 390px; min-height: 100vh; background: var(--cream); position: relative; overflow: hidden; display: flex; flex-direction: column; }
  .version-tag { position: absolute; top: 20px; right: 20px; font-size: 11px; color: var(--text-light); z-index: 10; font-weight: 300; }
  .blob { position: absolute; border-radius: 50%; pointer-events: none; z-index: 0; }
  .blob-1 { width: 280px; height: 280px; background: radial-gradient(circle, #FBDDD0 0%, transparent 70%); top: -80px; right: -60px; }
  .blob-2 { width: 200px; height: 200px; background: radial-gradient(circle, #F7E8D8 0%, transparent 70%); bottom: 100px; left: -60px; }
  .page { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 28px; opacity: 0; transform: translateY(20px); pointer-events: none; transition: opacity 0.45s ease, transform 0.45s ease; z-index: 1; }
  .page.active { opacity: 1; transform: translateY(0); pointer-events: all; }
  .logo-area { text-align: center; margin-bottom: 48px; }
  .logo-icon { font-size: 44px; margin-bottom: 10px; display: block; animation: float 3s ease-in-out infinite; }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
  .logo-title { font-family: 'Noto Serif KR', serif; font-size: 22px; color: var(--text-dark); letter-spacing: 2px; font-weight: 600; }
  .logo-sub { font-size: 13px; color: var(--text-light); margin-top: 6px; }
  .section-label { font-family: 'Noto Serif KR', serif; font-size: 17px; color: var(--text-dark); text-align: center; margin-bottom: 32px; line-height: 1.6; }
  .dir-btns { display: flex; gap: 32px; margin-bottom: 44px; }
  .dir-btn { width: 110px; height: 110px; border-radius: 50%; border: none; cursor: pointer; font-family: 'Noto Serif KR', serif; font-size: 18px; font-weight: 600; position: relative; transition: transform 0.2s; outline: none; }
  .dir-btn-left { background: linear-gradient(135deg, #F2A58E, #E8796A); color: white; box-shadow: 0 8px 28px rgba(232, 121, 106, 0.35); }
  .dir-btn-right { background: linear-gradient(135deg, #D4A96A, #C49050); color: white; box-shadow: 0 8px 28px rgba(196, 144, 80, 0.35); }
  .dir-btn-label { font-size: 12px; font-weight: 300; display: block; margin-top: 3px; font-family: 'Gowun Dodum', sans-serif; }
  .time-input-area { display: flex; align-items: center; gap: 10px; background: white; border-radius: 20px; padding: 16px 24px; box-shadow: 0 4px 20px rgba(196, 97, 74, 0.1); }
  .time-input { width: 56px; border: none; border-bottom: 2px solid var(--warm-rose); background: transparent; font-family: 'Noto Serif KR', serif; font-size: 22px; color: var(--deep-rose); text-align: center; outline: none; font-weight: 600; }
  .footer-notice { margin-top: auto; padding-bottom: 20px; text-align: center; font-size: 11px; color: var(--text-light); line-height: 1.8; }
  .timer-header { text-align: center; margin-bottom: 36px; }
  .timer-side { font-family: 'Noto Serif KR', serif; font-size: 26px; color: var(--text-dark); font-weight: 600; }
  .circle-wrap { position: relative; width: 240px; height: 240px; margin-bottom: 48px; }
  .circle-bg { position: absolute; inset: 0; border-radius: 50%; background: white; box-shadow: 0 12px 40px rgba(196, 97, 74, 0.15); }
  .circle-svg { position: absolute; inset: 0; transform: rotate(-90deg); }
  .circle-track { fill: none; stroke: #F5E0D8; stroke-width: 8; }
  .circle-progress { fill: none; stroke: var(--warm-rose); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 691; stroke-dashoffset: 0; transition: stroke-dashoffset 1s linear; }
  .circle-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .time-display { font-family: 'Noto Serif KR', serif; font-size: 52px; font-weight: 300; color: var(--text-dark); }
  .bottom-actions { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 390px; padding: 20px 28px 36px; display: flex; flex-direction: column; gap: 10px; z-index: 10; }
  .btn-primary { width: 100%; padding: 17px; border: none; border-radius: 18px; background: linear-gradient(135deg, #F2A58E, #E8796A); color: white; font-family: 'Noto Serif KR', serif; font-size: 17px; font-weight: 600; cursor: pointer; }
  .btn-secondary { width: 100%; padding: 14px; border: 2px solid var(--blush); border-radius: 18px; background: transparent; color: var(--text-mid); font-size: 15px; cursor: pointer; }
  .btn-primary:active, .btn-secondary:active { transform: scale(0.97); }
  .hidden { display: none !important; }
  .done-card { background: white; border-radius: 32px; padding: 40px 32px; text-align: center; width: 100%; box-shadow: 0 16px 50px rgba(196, 97, 74, 0.12); }
  .ping-ring { position: absolute; inset: -12px; border-radius: 50%; border: 3px solid var(--warm-rose); animation: ping 1.2s ease-out infinite; display: none; }
  .ping-ring.show { display: block; }
  @keyframes ping { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(1.4); opacity: 0; } }
</style>
</head>
<body>
<div class="phone-wrap">
  <div class="version-tag">v.1.1</div>
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <div class="page active" id="page-start">
    <div class="logo-area"><span class="logo-icon">ğŸ¤±</span><div class="logo-title">ìœ ì¶• íƒ€ì´ë¨¸</div></div>
    <div class="section-label">ìœ ì¶• ì‹œì‘ ë°©í–¥ì„<br>ì„ íƒí•´ ì£¼ì„¸ìš”</div>
    <div class="dir-btns">
      <button class="dir-btn dir-btn-left" onclick="handleBtnClick(() => startTimer('left'))">ì™¼ìª½<span class="dir-btn-label">â—€ LEFT</span></button>
      <button class="dir-btn dir-btn-right" onclick="handleBtnClick(() => startTimer('right'))">ì˜¤ë¥¸ìª½<span class="dir-btn-label">RIGHT â–¶</span></button>
    </div>
    <div class="time-input-area"><input type="number" class="time-input" id="duration-input" value="5"><span>ë¶„</span></div>
    <div class="footer-notice">â€» ë°±ê·¸ë¼ìš´ë“œì—ì„œë„ ì‘ë™í•˜ë„ë¡ ë³´ì™„ë˜ì—ˆìŠµë‹ˆë‹¤.<br>â€» ì•Œë¦¼ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì‹œë©´ ë” ì •í™•í•©ë‹ˆë‹¤.</div>
  </div>

  <div class="page" id="page-timer">
    <div class="timer-side" id="timer-side-label">ì™¼ìª½ ê°€ìŠ´</div>
    <div class="circle-wrap">
      <div class="ping-ring" id="ping-ring"></div>
      <svg class="circle-svg" viewBox="0 0 240 240"><circle class="circle-track" cx="120" cy="120" r="110"/><circle class="circle-progress" id="circle-prog" cx="120" cy="120" r="110"/></svg>
      <div class="circle-center"><div class="time-display" id="time-display">05:00</div></div>
    </div>
    <div class="session-stats" id="session-stats"></div>
    <div class="bottom-actions">
      <div id="running-actions"><button class="btn-secondary" onclick="handleBtnClick(endSession)">ì¢…ë£Œí•˜ê¸°</button></div>
      <div id="end-actions" class="hidden">
        <button class="btn-primary" onclick="handleBtnClick(startOpposite)">ë°˜ëŒ€ìª½ ì‹œì‘</button>
        <button class="btn-secondary" style="margin-top:10px;" onclick="handleBtnClick(endSession)">ì „ì²´ ì¢…ë£Œ</button>
      </div>
    </div>
  </div>

  <div class="page" id="page-done">
    <div class="done-card">
      <div class="done-title">ìˆ˜ê³ í•˜ì…¨ì–´ìš”</div>
      <div class="done-stats" id="done-stats-area"></div>
      <button class="btn-primary" onclick="handleBtnClick(resetApp)">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
  </div>
</div>

<script>
  let state = { currentSide: '', durationMin: 5, timerInterval: null, secondsLeft: 0, 
                endTime: 0, sessions: { left: { count: 0, seconds: 0 }, right: { count: 0, seconds: 0 } } };
  let wakeLock = null; let audioCtx = null; let silentOsc = null;

  // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ (ìµœì´ˆ ì‹¤í–‰ ì‹œ)
  if ("Notification" in window) Notification.requestPermission();

  function handleBtnClick(action) { 
    warmAudio(); 
    playBeep(660, 0.1); 
    if(action) action(); 
  }

  function warmAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    // ë¬´ìŒ ë£¨í”„ ì‹œì‘: ë¸Œë¼ìš°ì €ê°€ ì•±ì„ ì¢…ë£Œí•˜ì§€ ì•Šë„ë¡ ì†ì„
    if (!silentOsc) {
      silentOsc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      gain.gain.value = 0.001; // ê±°ì˜ ì•ˆë“¤ë¦¬ëŠ” ì†Œë¦¬
      silentOsc.connect(gain); gain.connect(audioCtx.destination);
      silentOsc.start();
    }
  }

  function playBeep(freq, dur) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.value = freq; gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
  }

  function startTimer(side) {
    state.durationMin = parseInt(document.getElementById('duration-input').value) || 5;
    state.currentSide = side;
    state.secondsLeft = state.durationMin * 60;
    state.endTime = Date.now() + (state.secondsLeft * 1000); // ì ˆëŒ€ ì¢…ë£Œ ì‹œê°„ ê¸°ë¡
    
    document.getElementById('running-actions').classList.remove('hidden');
    document.getElementById('end-actions').classList.add('hidden');
    document.getElementById('ping-ring').classList.remove('show');
    showPage('page-timer');
    runTimer();
  }

  function runTimer() {
    if (state.timerInterval) clearInterval(state.timerInterval);
    if ('wakeLock' in navigator) navigator.wakeLock.request('screen').then(lock => wakeLock = lock);

    state.timerInterval = setInterval(() => {
      // ì ˆëŒ€ ì‹œê°„ ê¸°ë°˜ìœ¼ë¡œ ë‚¨ì€ ì‹œê°„ ê³„ì‚° (ë°±ê·¸ë¼ìš´ë“œ ëŒ€ì‘)
      const now = Date.now();
      state.secondsLeft = Math.max(0, Math.round((state.endTime - now) / 1000));
      
      // í†µê³„ìš© ì´ˆ ì¦ê°€ (ì´ê±´ ì‹¤ì œ ì‹¤í–‰ë  ë•Œë§Œ ì˜¬ë¼ê°)
      state.sessions[state.currentSide].seconds++;
      
      updateDisplay();
      if (state.secondsLeft <= 0) {
        clearInterval(state.timerInterval);
        state.sessions[state.currentSide].count++;
        onTimerEnd();
      }
    }, 1000);
  }

  function updateDisplay() {
    const m = Math.floor(state.secondsLeft / 60).toString().padStart(2, '0');
    const s = (state.secondsLeft % 60).toString().padStart(2, '0');
    document.getElementById('time-display').textContent = `${m}:${s}`;
    const offset = (2 * Math.PI * 110) * (1 - (state.secondsLeft / (state.durationMin * 60)));
    document.getElementById('circle-prog').style.strokeDashoffset = offset;
    document.getElementById('circle-prog').style.strokeDasharray = 2 * Math.PI * 110;
  }

  function onTimerEnd() {
    playBeep(880, 0.5); setTimeout(() => playBeep(880, 0.5), 700);
    document.getElementById('ping-ring').classList.add('show');
    document.getElementById('running-actions').classList.add('hidden');
    document.getElementById('end-actions').classList.remove('hidden');
    if (Notification.permission === "granted") {
      new Notification("ìœ ì¶• ì™„ë£Œ!", { body: `${state.currentSide === 'left' ? 'ì™¼ìª½' : 'ì˜¤ë¥¸ìª½'} ìœ ì¶•ì´ ëë‚¬ìŠµë‹ˆë‹¤.` });
    }
  }

  function startOpposite() {
    state.currentSide = state.currentSide === 'left' ? 'right' : 'left';
    state.secondsLeft = state.durationMin * 60;
    state.endTime = Date.now() + (state.secondsLeft * 1000);
    document.getElementById('running-actions').classList.remove('hidden');
    document.getElementById('end-actions').classList.add('hidden');
    document.getElementById('ping-ring').classList.remove('show');
    runTimer();
  }

  function endSession() {
    clearInterval(state.timerInterval);
    if (wakeLock) wakeLock.release();
    const L = state.sessions.left; const R = state.sessions.right;
    document.getElementById('done-stats-area').innerHTML = `
      <p>ì™¼ìª½: ${Math.floor(L.seconds/60)}ë¶„ ${L.seconds%60}ì´ˆ</p>
      <p>ì˜¤ë¥¸ìª½: ${Math.floor(R.seconds/60)}ë¶„ ${R.seconds%60}ì´ˆ</p>
      <p><b>ì´í•©: ${Math.floor((L.seconds+R.seconds)/60)}ë¶„</b></p>
    `;
    showPage('page-done');
  }

  function resetApp() { location.reload(); }
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // í™”ë©´ ë³µê·€ ì‹œ ë™ê¸°í™”
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible' && state.timerInterval) {
      const now = Date.now();
      if (now >= state.endTime) {
        // ì´ë¯¸ ì‹œê°„ì´ ì§€ë‚¬ë‹¤ë©´ ì¦‰ì‹œ ì¢…ë£Œ ì²˜ë¦¬
        state.secondsLeft = 0;
        clearInterval(state.timerInterval);
        onTimerEnd();
      }
    }
  });
</script>
</body>
</html>
