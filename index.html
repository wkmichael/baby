<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ìœ ì¶• íƒ€ì´ë¨¸</title>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #FFF8F2;
    --warm-rose: #F2A58E;
    --soft-coral: #E8896E;
    --blush: #F7D5C8;
    --deep-rose: #C4614A;
    --warm-brown: #8B5E52;
    --muted-gold: #D4A96A;
    --text-dark: #3D2B24;
    --text-mid: #7A5049;
    --text-light: #B8897D;
    --white: #FFFFFF;
  }

- { margin: 0; padding: 0; box-sizing: border-box; }

body {
font-family: â€˜Gowun Dodumâ€™, sans-serif;
background: var(â€“cream);
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
overflow: hidden;
}

.phone-wrap {
width: 100%;
max-width: 390px;
min-height: 100vh;
background: var(â€“cream);
position: relative;
overflow: hidden;
display: flex;
flex-direction: column;
}

/* Decorative blobs */
.blob {
position: absolute;
border-radius: 50%;
pointer-events: none;
z-index: 0;
}
.blob-1 {
width: 280px; height: 280px;
background: radial-gradient(circle, #FBDDD0 0%, transparent 70%);
top: -80px; right: -60px;
}
.blob-2 {
width: 200px; height: 200px;
background: radial-gradient(circle, #F7E8D8 0%, transparent 70%);
bottom: 100px; left: -60px;
}

/* ===== PAGE SYSTEM ===== */
.page {
position: absolute;
inset: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 40px 28px;
opacity: 0;
transform: translateY(20px);
pointer-events: none;
transition: opacity 0.45s ease, transform 0.45s ease;
z-index: 1;
}
.page.active {
opacity: 1;
transform: translateY(0);
pointer-events: all;
}

/* ===== START PAGE ===== */
.logo-area {
text-align: center;
margin-bottom: 48px;
}
.logo-icon {
font-size: 44px;
margin-bottom: 10px;
display: block;
animation: float 3s ease-in-out infinite;
}
@keyframes float {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-6px); }
}
.logo-title {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 22px;
color: var(â€“text-dark);
letter-spacing: 2px;
font-weight: 600;
}
.logo-sub {
font-size: 13px;
color: var(â€“text-light);
margin-top: 6px;
letter-spacing: 1px;
}

.section-label {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 17px;
color: var(â€“text-dark);
text-align: center;
margin-bottom: 32px;
font-weight: 400;
line-height: 1.6;
}

.dir-btns {
display: flex;
gap: 32px;
margin-bottom: 44px;
}

.dir-btn {
width: 110px;
height: 110px;
border-radius: 50%;
border: none;
cursor: pointer;
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 18px;
font-weight: 600;
letter-spacing: 1px;
position: relative;
transition: transform 0.2s, box-shadow 0.2s;
outline: none;
}
.dir-btn-left {
background: linear-gradient(135deg, #F2A58E, #E8796A);
color: white;
box-shadow: 0 8px 28px rgba(232, 121, 106, 0.35);
}
.dir-btn-right {
background: linear-gradient(135deg, #D4A96A, #C49050);
color: white;
box-shadow: 0 8px 28px rgba(196, 144, 80, 0.35);
}
.dir-btn:active {
transform: scale(0.93);
box-shadow: 0 4px 14px rgba(0,0,0,0.15);
}
.dir-btn-label {
font-size: 12px;
font-weight: 300;
display: block;
margin-top: 3px;
opacity: 0.85;
letter-spacing: 0;
font-family: â€˜Gowun Dodumâ€™, sans-serif;
}

/* Ripple effect */
.dir-btn::after {
content: â€˜â€™;
position: absolute;
inset: -6px;
border-radius: 50%;
border: 2px solid currentColor;
opacity: 0;
transition: opacity 0.3s, transform 0.3s;
}
.dir-btn:hover::after {
opacity: 0.25;
transform: scale(1.05);
}

/* Time input */
.time-input-area {
display: flex;
align-items: center;
gap: 10px;
background: white;
border-radius: 20px;
padding: 16px 24px;
box-shadow: 0 4px 20px rgba(196, 97, 74, 0.1);
}
.time-label {
font-size: 15px;
color: var(â€“text-mid);
}
.time-input {
width: 56px;
border: none;
border-bottom: 2px solid var(â€“warm-rose);
background: transparent;
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 22px;
color: var(â€“deep-rose);
text-align: center;
outline: none;
font-weight: 600;
}
.time-input::-webkit-inner-spin-button { display: none; }

/* ===== TIMER PAGE ===== */
.timer-header {
text-align: center;
margin-bottom: 36px;
}
.timer-direction {
font-size: 13px;
color: var(â€“text-light);
letter-spacing: 2px;
text-transform: uppercase;
margin-bottom: 6px;
}
.timer-side {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 26px;
color: var(â€“text-dark);
font-weight: 600;
}

/* Circular timer */
.circle-wrap {
position: relative;
width: 240px;
height: 240px;
margin-bottom: 48px;
}
.circle-bg {
position: absolute;
inset: 0;
border-radius: 50%;
background: white;
box-shadow: 0 12px 40px rgba(196, 97, 74, 0.15), inset 0 0 0 2px #F5E0D8;
}
.circle-svg {
position: absolute;
inset: 0;
transform: rotate(-90deg);
}
.circle-track {
fill: none;
stroke: #F5E0D8;
stroke-width: 8;
}
.circle-progress {
fill: none;
stroke: var(â€“warm-rose);
stroke-width: 8;
stroke-linecap: round;
stroke-dasharray: 691;
stroke-dashoffset: 0;
transition: stroke-dashoffset 1s linear;
}
.circle-center {
position: absolute;
inset: 0;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
}
.time-display {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 52px;
font-weight: 300;
color: var(â€“text-dark);
letter-spacing: 2px;
line-height: 1;
}
.time-unit {
font-size: 13px;
color: var(â€“text-light);
margin-top: 6px;
letter-spacing: 1px;
}

/* Session stats */
.session-stats {
font-size: 12px;
color: var(â€“text-light);
letter-spacing: 1px;
text-align: center;
line-height: 1.8;
}

/* Bottom actions */
.bottom-actions {
position: fixed;
bottom: 0;
left: 50%;
transform: translateX(-50%);
width: 100%;
max-width: 390px;
padding: 20px 28px 36px;
background: linear-gradient(to top, var(â€“cream) 75%, transparent);
display: flex;
flex-direction: column;
gap: 10px;
z-index: 10;
}

.btn-primary {
width: 100%;
padding: 17px;
border: none;
border-radius: 18px;
background: linear-gradient(135deg, #F2A58E, #E8796A);
color: white;
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 17px;
font-weight: 600;
cursor: pointer;
box-shadow: 0 6px 24px rgba(232, 121, 106, 0.35);
transition: transform 0.18s, box-shadow 0.18s;
letter-spacing: 1px;
}
.btn-primary:active {
transform: scale(0.97);
box-shadow: 0 3px 12px rgba(232, 121, 106, 0.25);
}
.btn-secondary {
width: 100%;
padding: 14px;
border: 2px solid var(â€“blush);
border-radius: 18px;
background: transparent;
color: var(â€“text-mid);
font-family: â€˜Gowun Dodumâ€™, sans-serif;
font-size: 15px;
cursor: pointer;
transition: background 0.18s;
letter-spacing: 1px;
}
.btn-secondary:active { background: var(â€“blush); }

.stats-inline {
text-align: center;
font-size: 12px;
color: var(â€“text-light);
letter-spacing: 0.5px;
line-height: 1.7;
padding-top: 4px;
}

.hidden { display: none !important; }

/* ===== DONE PAGE ===== */
.done-card {
background: white;
border-radius: 32px;
padding: 40px 32px;
box-shadow: 0 16px 50px rgba(196, 97, 74, 0.12);
text-align: center;
width: 100%;
}
.done-icon {
font-size: 52px;
margin-bottom: 20px;
display: block;
animation: float 3s ease-in-out infinite;
}
.done-title {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 22px;
color: var(â€“text-dark);
font-weight: 600;
margin-bottom: 28px;
letter-spacing: 1px;
}
.done-stats {
background: var(â€“cream);
border-radius: 20px;
padding: 22px 24px;
margin-bottom: 24px;
}
.done-stat-row {
display: flex;
justify-content: space-between;
align-items: center;
padding: 8px 0;
border-bottom: 1px solid var(â€“blush);
}
.done-stat-row:last-child { border-bottom: none; }
.done-stat-label {
font-size: 15px;
color: var(â€“text-mid);
letter-spacing: 0.5px;
}
.done-stat-value {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 17px;
color: var(â€“deep-rose);
font-weight: 600;
}
.done-total-row {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 16px;
padding-top: 12px;
border-top: 2px solid var(â€“blush);
}
.done-total-label {
font-size: 14px;
color: var(â€“text-light);
letter-spacing: 1px;
}
.done-total-value {
font-family: â€˜Noto Serif KRâ€™, serif;
font-size: 20px;
color: var(â€“warm-brown);
font-weight: 600;
}
.done-love {
font-size: 15px;
color: var(â€“warm-rose);
margin-top: 6px;
letter-spacing: 2px;
animation: pulse 2s ease-in-out infinite;
}
@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

/* Pulsing ring on timer done */
@keyframes ping {
0% { transform: scale(1); opacity: 0.6; }
100% { transform: scale(1.4); opacity: 0; }
}
.ping-ring {
position: absolute;
inset: -12px;
border-radius: 50%;
border: 3px solid var(â€“warm-rose);
animation: ping 1.2s ease-out infinite;
display: none;
}
.ping-ring.show { display: block; }
</style>

</head>
<body>
<div class="phone-wrap">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <!-- ===== START PAGE ===== -->

  <div class="page active" id="page-start">
    <div class="logo-area">
      <span class="logo-icon">ğŸ¤±</span>
      <div class="logo-title">ìœ ì¶• íƒ€ì´ë¨¸</div>
      <div class="logo-sub">ì†Œì¤‘í•œ ì‹œê°„ì„ í•¨ê»˜í•´ìš”</div>
    </div>

```
<div class="section-label">ìœ ì¶• ì‹œì‘ ë°©í–¥ì„<br>ì„ íƒí•´ ì£¼ì„¸ìš”</div>

<div class="dir-btns">
  <button class="dir-btn dir-btn-left" onclick="startTimer('left')">
    ì™¼ìª½
    <span class="dir-btn-label">â—€ LEFT</span>
  </button>
  <button class="dir-btn dir-btn-right" onclick="startTimer('right')">
    ì˜¤ë¥¸ìª½
    <span class="dir-btn-label">RIGHT â–¶</span>
  </button>
</div>

<div class="time-input-area">
  <span class="time-label">1íšŒ ìœ ì¶• ì‹œê°„</span>
  <input type="number" class="time-input" id="duration-input" value="5" min="1" max="60">
  <span class="time-label">ë¶„</span>
</div>
```

  </div>

  <!-- ===== TIMER PAGE ===== -->

  <div class="page" id="page-timer">
    <div class="timer-header">
      <div class="timer-direction">í˜„ì¬ ìœ ì¶• ì¤‘</div>
      <div class="timer-side" id="timer-side-label">ì™¼ìª½ ê°€ìŠ´</div>
    </div>

```
<div class="circle-wrap">
  <div class="circle-bg"></div>
  <div class="ping-ring" id="ping-ring"></div>
  <svg class="circle-svg" viewBox="0 0 240 240">
    <circle class="circle-track" cx="120" cy="120" r="110"/>
    <circle class="circle-progress" id="circle-prog" cx="120" cy="120" r="110"/>
  </svg>
  <div class="circle-center">
    <div class="time-display" id="time-display">05:00</div>
    <div class="time-unit">ë‚¨ì€ ì‹œê°„</div>
  </div>
</div>

<div class="session-stats" id="session-stats"></div>

<!-- Buttons (shown after timer ends) -->
<div class="bottom-actions hidden" id="timer-actions">
  <button class="btn-primary" id="btn-opposite" onclick="startOpposite()">ë°˜ëŒ€ìª½ ì‹œì‘</button>
  <button class="btn-secondary" onclick="endSession()">ì¢…ë£Œ</button>
  <div class="stats-inline" id="stats-inline-text"></div>
</div>
```

  </div>

  <!-- ===== DONE PAGE ===== -->

  <div class="page" id="page-done">
    <div class="done-card">
      <span class="done-icon">ğŸ’•</span>
      <div class="done-title">ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”</div>
      <div class="done-stats" id="done-stats-area"></div>
      <div class="done-love">ì—„ë§ˆ ê³ ë§ˆì›Œìš” â™¥</div>
    </div>
  </div>
</div>

<script>
  // State
  let state = {
    firstSide: '',
    currentSide: '',
    durationMin: 5,
    timerInterval: null,
    secondsLeft: 0,
    totalSeconds: 0,
    sessions: { left: { count: 0, seconds: 0 }, right: { count: 0, seconds: 0 } }
  };

  const CIRCUMFERENCE = 2 * Math.PI * 110; // ~691

  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function startTimer(side) {
    warmAudio(); // iOS: AudioContext must be created inside a user gesture tap
    state.durationMin = parseInt(document.getElementById('duration-input').value) || 5;
    state.firstSide = side;
    state.currentSide = side;
    runTimer();
  }

  function startOpposite() {
    warmAudio(); // keep AudioContext alive
    state.currentSide = state.currentSide === 'left' ? 'right' : 'left';
    document.getElementById('timer-actions').classList.add('hidden');
    document.getElementById('ping-ring').classList.remove('show');
    runTimer();
  }

  function runTimer() {
    const sideLabel = state.currentSide === 'left' ? 'ì™¼ìª½ ê°€ìŠ´' : 'ì˜¤ë¥¸ìª½ ê°€ìŠ´';
    document.getElementById('timer-side-label').textContent = sideLabel;
    showPage('page-timer');
    requestWakeLock(); // íƒ€ì´ë¨¸ ì‹œì‘ ì‹œ í™”ë©´ êº¼ì§ ë°©ì§€

    state.secondsLeft = state.durationMin * 60;
    state.totalSeconds = state.durationMin * 60;

    updateDisplay();
    updateCircle(1);

    if (state.timerInterval) clearInterval(state.timerInterval);

    state.timerInterval = setInterval(() => {
      state.secondsLeft--;
      state.sessions[state.currentSide].seconds++;
      updateDisplay();
      updateCircle(state.secondsLeft / state.totalSeconds);

      if (state.secondsLeft <= 0) {
        clearInterval(state.timerInterval);
        state.timerInterval = null;
        state.sessions[state.currentSide].count++;
        releaseWakeLock(); // íƒ€ì´ë¨¸ ì¢…ë£Œ ì‹œ Wake Lock í•´ì œ
        onTimerEnd();
      }
    }, 1000);
  }

  function updateDisplay() {
    const m = Math.floor(state.secondsLeft / 60).toString().padStart(2, '0');
    const s = (state.secondsLeft % 60).toString().padStart(2, '0');
    document.getElementById('time-display').textContent = `${m}:${s}`;

    const statsText = getStatsText();
    document.getElementById('session-stats').textContent = statsText;
  }

  function updateCircle(ratio) {
    const offset = CIRCUMFERENCE * (1 - ratio);
    document.getElementById('circle-prog').style.strokeDashoffset = offset;
    document.getElementById('circle-prog').style.strokeDasharray = CIRCUMFERENCE;
  }

  function onTimerEnd() {
    playAlarm();
    document.getElementById('ping-ring').classList.add('show');
    document.getElementById('stats-inline-text').textContent = getStatsText();
    document.getElementById('timer-actions').classList.remove('hidden');
  }

  // â”€â”€ NoSleep: ë¬´ìŒ video loopìœ¼ë¡œ í™”ë©´ êº¼ì§ ë°©ì§€ â”€â”€
  let noSleepVideo = null;

  function createNoSleepVideo() {
    if (noSleepVideo) return;
    // 1x1 íˆ¬ëª… WebM (base64) â€” ì¬ìƒ ì¤‘ì´ë©´ iOS/Androidê°€ í™”ë©´ì„ ë„ì§€ ì•ŠìŒ
    const src = 'data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggFGTbuMU6uEHlO7a1OsggGETbuMU6uEHxO7a1OsggHITbuMU6uEIDO7a1OsggHlTbuMU6uEIXO7a1OsggHyTbuMU6uEIlO7a1OsggICTbuMU6uEIvO7a1OsggIPTbuMU6uEI3O7a1OsggIUTbuMU6uEJBO7a1OsggIZTbuMU6uEJFO7a1OsggIeTbuMU6uEJJO7a1OsggIjTbuMU6uEJNO7a1OsggIoTbuMU6uEJRO7a1OsggItTbuMU6uEJVO7a1OsggIyTbuMU6uEJZO7a1OsggI3TbuMU6uEJdO7a1OsggI8TbuMU6uEJhO7a1OsggJBTbuMU6uEJlO7a1OsggJGTbuMU6uEJpO7a1OsggJLTbuMU6uEJtO7a1OsggJQTbuMU6uEJxO7a1OsggJVTbuMU6uEJ1O7a1OsggJaTbuMU6uEJ5O7a1OsggJfTbuMU6uEJ9O7a1OsggJkSsGBAlvBieyBgaGBh6+gQGIgQAA';
    noSleepVideo = document.createElement('video');
    noSleepVideo.setAttribute('loop', '');
    noSleepVideo.setAttribute('playsinline', '');
    noSleepVideo.setAttribute('muted', '');
    noSleepVideo.setAttribute('webkit-playsinline', '');
    noSleepVideo.style.cssText = 'position:fixed;width:1px;height:1px;opacity:0;pointer-events:none;';
    noSleepVideo.src = src;
    document.body.appendChild(noSleepVideo);
  }

  function noSleepEnable() {
    createNoSleepVideo();
    noSleepVideo && noSleepVideo.play().catch(() => {});
  }

  function noSleepDisable() {
    if (noSleepVideo) {
      noSleepVideo.pause();
    }
  }

  function requestWakeLock() {
    noSleepEnable();
  }

  function releaseWakeLock() {
    noSleepDisable();
  }

  // â”€â”€ AudioContext: iOS requires it to be created & resumed inside a user gesture.
  //    We create it once on the very first user tap, then reuse it.
  let audioCtx = null;

  function ensureAudioCtx() {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    // iOS suspends the context if no user gesture recently; resume it.
    if (audioCtx.state === 'suspended') {
      audioCtx.resume();
    }
  }

  // Call this on every button tap so AudioContext is warm when we need it.
  function warmAudio() {
    try { ensureAudioCtx(); } catch(e) {}
  }

  function getStatsText() {
    const L = state.sessions.left;
    const R = state.sessions.right;
    // Math.floor: count a minute only after a full 60 seconds have elapsed
    return `ì™¼ìª½ ${L.count}íšŒ(${Math.floor(L.seconds/60)}ë¶„)  Â·  ì˜¤ë¥¸ìª½ ${R.count}íšŒ(${Math.floor(R.seconds/60)}ë¶„)`;
  }

  function endSession() {
    clearInterval(state.timerInterval);
    state.timerInterval = null;
    releaseWakeLock(); // ì¢…ë£Œ ë²„íŠ¼ ì‹œ Wake Lock í•´ì œ
    buildDoneStats();
    showPage('page-done');
  }

  function buildDoneStats() {
    const L = state.sessions.left;
    const R = state.sessions.right;
    // Math.floor for total as well
    const totalMin = Math.floor((L.seconds + R.seconds) / 60);

    const area = document.getElementById('done-stats-area');
    area.innerHTML = `
      <div class="done-stat-row">
        <span class="done-stat-label">â—€ ì™¼ìª½</span>
        <span class="done-stat-value">${L.count}íšŒ Â· ${Math.floor(L.seconds/60)}ë¶„</span>
      </div>
      <div class="done-stat-row">
        <span class="done-stat-label">ì˜¤ë¥¸ìª½ â–¶</span>
        <span class="done-stat-value">${R.count}íšŒ Â· ${Math.floor(R.seconds/60)}ë¶„</span>
      </div>
      <div class="done-total-row">
        <span class="done-total-label">ì´ ìœ ì¶• ì‹œê°„</span>
        <span class="done-total-value">${totalMin}ë¶„</span>
      </div>
    `;
  }

  function playAlarm() {
    try {
      ensureAudioCtx();
      const ctx = audioCtx;

      function beep(startTime) {
        const osc  = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.frequency.value = 880; // A5
        osc.type = 'sine';

        gain.gain.setValueAtTime(0, startTime);
        gain.gain.linearRampToValueAtTime(0.8, startTime + 0.05);
        gain.gain.setValueAtTime(0.8, startTime + 0.35);
        gain.gain.linearRampToValueAtTime(0, startTime + 0.55);

        osc.start(startTime);
        osc.stop(startTime + 0.6);
      }

      // 2íšŒ ìš¸ë¦¼ (0.75ì´ˆ ê°„ê²©)
      beep(ctx.currentTime);
      beep(ctx.currentTime + 0.75);
    } catch(e) {
      console.warn('Audio error:', e);
    }
  }
</script>

</body>
</html>
